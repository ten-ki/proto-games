<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NITA GAMES // SYSTEM</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* --- CYBERPUNK THEME --- */
        :root {
            --bg: #050505;
            --text: #e0e0e0;
            --green: #00ff41;
            --red: #ff0055;
            --cyan: #00eaff;
            --gold: #ffd700;
        }
        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Courier New', monospace;
            margin: 0; height: 100vh; display: flex; overflow: hidden;
            background-image: linear-gradient(rgba(0,255,65,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,255,65,0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        body::after {
            content: " "; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 50; opacity: 0.5;
        }

        /* --- LAYOUT --- */
        #main-interface {
            display: flex; width: 100%; height: 100%;
            padding: 20px; gap: 20px; box-sizing: border-box; z-index: 10;
        }
        #game-area {
            flex: 3; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid #333; background: rgba(10,15,10,0.9); border-radius: 8px; position: relative;
        }
        #chat-area {
            flex: 1; display: flex; flex-direction: column; min-width: 300px;
            border: 1px solid #333; background: rgba(0,10,0,0.95); border-radius: 8px;
        }

        /* --- LOGIN --- */
        #login-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; gap: 40px; align-items: center; justify-content: center;
        }
        .box {
            background: #111; border: 1px solid #444; padding: 30px;
            display: flex; flex-direction: column; gap: 15px;
            box-shadow: 0 0 30px var(--green); border-radius: 4px;
        }
        .lobby-chat { width: 350px; height: 450px; display: flex; flex-direction: column; }
        .lobby-log { flex-grow: 1; overflow-y: auto; border: 1px solid #333; padding: 10px; font-size: 0.8rem; background: #000; }
        
        input, select, button {
            background: #000; border: 1px solid #444; color: var(--text);
            padding: 12px; font-family: inherit; text-transform: uppercase; outline: none;
        }
        button { cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: var(--green); color: #000; box-shadow: 0 0 15px var(--green); }

        /* --- CHAT UI --- */
        .chat-header { padding: 10px; background: rgba(0,30,0,0.8); border-bottom: 1px solid #444; font-size: 0.8rem; color: #888; }
        .chat-log { flex-grow: 1; overflow-y: auto; padding: 10px; font-size: 0.85rem; }
        .chat-input-row { display: flex; border-top: 1px solid #444; }
        .chat-input-row input { flex-grow: 1; border: none; }
        .chat-msg { margin-bottom: 4px; word-break: break-all; }

        /* --- GAME UI --- */
        h1 { position: absolute; top: 10px; left: 20px; margin: 0; font-size: 2rem; color: #fff; text-shadow: 0 0 10px var(--green); pointer-events: none; }
        
        /* Othello */
        .othello-board { display: grid; grid-template-columns: repeat(8, 50px); gap: 2px; background: #111; border: 2px solid #444; padding: 5px; }
        .o-cell { width: 50px; height: 50px; background: #0a2a0a; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .o-stone { width: 40px; height: 40px; border-radius: 50%; transition: 0.5s; }
        .o-black { background: #111; border: 1px solid #444; box-shadow: inset 2px 2px 5px rgba(255,255,255,0.3); }
        .o-white { background: #eee; box-shadow: 0 0 10px #fff; }
        
        /* Connect 4 */
        .c4-board { position: relative; padding: 15px; border: 2px solid #444; background: rgba(255,255,255,0.05); border-radius: 10px; cursor: pointer; }
        .c4-grid { display: grid; grid-template-columns: repeat(7, 60px); gap: 10px; pointer-events: none; }
        .c4-hole { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.15); border-radius: 50%; }
        .c4-piece { position: absolute; width: 60px; height: 60px; border-radius: 50%; z-index: -1; transition: top 0.5s ease-in; }
        .c4-red { background: var(--red); box-shadow: 0 0 15px var(--red); }
        .c4-cyan { background: var(--cyan); box-shadow: 0 0 15px var(--cyan); }
        
        /* Blackjack */
        #bj-table { width: 90%; height: 90%; border-radius: 100px; border: 4px double #444; background: radial-gradient(circle, #112, #000); position: relative; display: none; }
        .bj-dealer { position: absolute; top: 15%; width: 100%; text-align: center; }
        .bj-seats { position: absolute; bottom: 5%; width: 100%; display: flex; justify-content: space-around; align-items: flex-end; }
        .bj-seat { width: 140px; min-height: 180px; background: rgba(0,0,0,0.5); border: 1px dashed #444; padding: 10px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .bj-seat.active { border-color: #fff; background: rgba(50,50,50,0.8); }
        .cards { display: flex; justify-content: center; height: 70px; margin-top: 5px; }
        .card { width: 45px; height: 65px; background: #eee; color: #000; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-weight: bold; margin-left: -20px; border: 1px solid #999; animation: deal 0.3s ease-out; }
        .card:first-child { margin-left: 0; }
        .card.red { color: #d00; }
        .card.back { background: #222; color: #222; border-color: #444; }
        @keyframes deal { from{opacity:0;transform:translateY(-50px);} to{opacity:1;transform:translateY(0);} }

        #bet-ui { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 20; border-radius: 90px; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .chip { width: 70px; height: 70px; border-radius: 50%; background: #000; border: 2px solid var(--gold); color: var(--gold); display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; margin: 10px; }
        .chip:hover { background: var(--gold); color: #000; }

    </style>
</head>
<body>

    <!-- LOGIN & LOBBY -->
    <div id="login-overlay">
        <div class="box">
            <h2 style="text-align:center; margin:0; color:#888;">NITA GAMES // LOGIN</h2>
            <input type="text" id="username" placeholder="CODENAME" maxlength="10">
            <input type="text" id="room" placeholder="FREQUENCY (ROOM ID)">
            <select id="gameType">
                <option value="othello">TACTICS (OTHELLO)</option>
                <option value="connect4">GRAVITY (CONNECT 4)</option>
                <option value="blackjack">PROTOCOL 21 (BLACKJACK)</option>
            </select>
            <button onclick="joinGame()">INITIALIZE LINK</button>
        </div>
        
        <div class="box lobby-chat">
            <div class="chat-header">// GLOBAL FREQUENCY</div>
            <div id="lobby-log" class="lobby-log"></div>
            <div class="chat-input-row">
                <input type="text" id="lobby-input" placeholder="BROADCAST..." onkeydown="if(event.key==='Enter')sendLobby()">
                <button onclick="sendLobby()">TX</button>
            </div>
        </div>
    </div>

    <!-- MAIN INTERFACE -->
    <div id="main-interface" style="display:none;">
        <h1>NITA GAMES</h1>

        <!-- GAME -->
        <div id="game-area">
            <div id="game-hud" style="margin-bottom:20px; font-size:1.5rem; display:none;">
                <span id="p1-tag" style="margin-right:20px;">P1</span> VS <span id="p2-tag" style="margin-left:20px;">P2</span>
            </div>

            <div id="board-container"></div>

            <!-- BJ TABLE -->
            <div id="bj-table">
                <div style="position:absolute; top:20px; left:30px; color:var(--green);" id="bj-info">ROUND: 1/7</div>
                <div id="bet-ui">
                    <h2 style="color:#fff;">PLACE WAGER</h2>
                    <div style="display:flex;">
                        <div class="chip" onclick="bet(2)">2</div>
                        <div class="chip" onclick="bet(5)">5</div>
                        <div class="chip" onclick="bet(10)">10</div>
                    </div>
                </div>
                <div class="bj-dealer">
                    <div style="font-size:0.8rem; color:#888;">DEALER</div>
                    <div class="cards" id="d-cards"></div>
                </div>
                <div class="bj-seats" id="bj-seats"></div>
            </div>
        </div>

        <!-- ROOM CHAT -->
        <div id="chat-area">
            <div class="chat-header">// ROOM COMMS (SECURE)</div>
            <div id="chat-log" class="chat-log"></div>
            <div class="chat-input-row">
                <input type="text" id="chat-input" placeholder="TRANSMIT..." onkeydown="if(event.key==='Enter')sendChat()">
                <button onclick="sendChat()">TX</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let roomID = '', myUser = '', myColor = '', gameType = '';

        // --- CHAT ---
        function sendLobby() {
            const i = document.getElementById('lobby-input');
            if(i.value) { socket.emit('lobbyMsg', {username: document.getElementById('username').value, text: i.value}); i.value=''; }
        }
        socket.on('lobbyMsg', d => {
            const l = document.getElementById('lobby-log');
            l.innerHTML += `<div><span style="color:var(--green)">[${d.username}]</span> ${d.text}</div>`; l.scrollTop = l.scrollHeight;
        });

        function sendChat() {
            const i = document.getElementById('chat-input');
            if(i.value) { socket.emit('roomMsg', {room:roomID, username:myUser, text:i.value, color:myColor}); i.value=''; }
        }
        socket.on('roomMsg', d => {
            const l = document.getElementById('chat-log');
            const c = d.color === 'black' ? '#aaa' : (d.color === 'white' ? '#fff' : d.color);
            l.innerHTML += `<div class="chat-msg"><span style="color:${c}">[${d.username}]</span> ${d.text}</div>`; l.scrollTop = l.scrollHeight;
        });

        // --- JOIN ---
        function joinGame() {
            myUser = document.getElementById('username').value || 'ANONYMOUS';
            roomID = document.getElementById('room').value;
            gameType = document.getElementById('gameType').value;
            if(!roomID) return alert("ROOM ID REQUIRED");
            socket.emit('joinRoom', {username:myUser, room:roomID, gameType});
        }
        
        socket.on('joined', d => {
            myColor = d.color; gameType = d.gameType;
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('main-interface').style.display = 'flex';
        });

        socket.on('roomUpdate', d => {
            if(d.gameType === 'blackjack') {
                document.getElementById('game-hud').style.display = 'none';
                document.getElementById('board-container').innerHTML = '';
                document.getElementById('bj-table').style.display = 'block';
                document.getElementById('bj-info').innerText = `ROUND: -/${d.maxRounds}`;
                renderBjSeats(d.players);
            }
        });

        socket.on('gameStart', d => {
            if(d.gameType !== 'blackjack') {
                document.getElementById('bj-table').style.display = 'none';
                document.getElementById('game-hud').style.display = 'block';
                document.getElementById('p1-tag').innerText = d.p1; document.getElementById('p2-tag').innerText = d.p2;
                if(d.gameType === 'othello') renderOthello(d.board); else setupC4();
                updateTurn(d.turn);
            }
        });

        // --- BJ UI ---
        function renderBjSeats(players) {
            const c = document.getElementById('bj-seats'); c.innerHTML = '';
            players.forEach((p, i) => {
                const div = document.createElement('div'); div.className = 'bj-seat'; div.id = `seat-${i}`;
                div.innerHTML = `
                    <div style="color:${p.color}; font-weight:bold;">${p.username}</div>
                    <div style="color:var(--gold); font-weight:bold;">${p.score} PTS</div>
                    <div style="color:#fff; font-size:0.8rem;" id="stat-${i}">${p.ready?'READY':''}</div>
                    <div class="cards" id="hand-${i}"></div>
                    <div id="ctrl-${i}" style="margin-top:auto; width:100%;"></div>
                `;
                c.appendChild(div);
                if(p.hand) { const h = div.querySelector('.cards'); p.hand.forEach(cd=>h.appendChild(mkCard(cd))); }
                
                // READY Button
                if(p.id === socket.id && !p.ready && p.hand.length === 0) {
                    const btn = document.createElement('button'); btn.innerText = "READY"; btn.style.width = '100%';
                    btn.onclick = () => socket.emit('bjToggleReady', {room:roomID});
                    div.querySelector(`#ctrl-${i}`).appendChild(btn);
                }
            });
        }
        function mkCard(c) {
            const el = document.createElement('div'); el.className = `card ${['♥','♦'].includes(c.suit)?'red':''}`;
            if(c.suit==='?') el.className += ' back'; else el.innerText = c.rank + c.suit;
            return el;
        }
        function bet(a) { socket.emit('bjBet', {room:roomID, amount:a}); document.getElementById('bet-ui').style.display='none'; }

        socket.on('bjRoundStart', d => {
            document.getElementById('bj-info').innerText = `ROUND: ${d.round}/${d.maxRounds}`;
            document.getElementById('bet-ui').style.display = 'flex';
            document.getElementById('d-cards').innerHTML = '';
        });
        
        socket.on('bjUpdate', d => {
            document.getElementById('bet-ui').style.display = 'none';
            const dc = document.getElementById('d-cards'); dc.innerHTML = ''; d.dealerHand.forEach(c=>dc.appendChild(mkCard(c)));
            d.players.forEach((p,i) => {
                const h = document.getElementById(`hand-${i}`); if(h){ h.innerHTML=''; p.hand.forEach(c=>h.appendChild(mkCard(c))); }
                const st = document.getElementById(`stat-${i}`); if(st) st.innerText = p.status==='playing'?'':p.status;
                const s = document.getElementById(`seat-${i}`); if(s) {
                    if(i===d.turnIndex && d.phase==='playing') s.classList.add('active'); else s.classList.remove('active');
                    const ctrl = document.getElementById(`ctrl-${i}`); ctrl.innerHTML='';
                    if(p.id===socket.id && i===d.turnIndex && d.phase==='playing') {
                        ctrl.innerHTML = `<button onclick="socket.emit('bjAction',{room:roomID,action:'hit'})">HIT</button> <button onclick="socket.emit('bjAction',{room:roomID,action:'stand'})">STAND</button>`;
                    }
                }
            });
        });

        socket.on('bjRoundOver', d => {
             const dc = document.getElementById('d-cards'); dc.innerHTML = ''; d.dealerHand.forEach(c=>dc.appendChild(mkCard(c)));
             d.players.forEach((p,i) => {
                 const st = document.getElementById(`stat-${i}`); if(st) { st.innerText = p.result; st.style.color = p.result.includes('WIN')?'#0f0':'#f00'; }
                 const s = document.getElementById(`seat-${i}`); if(s) s.children[1].innerText = `${p.score} PTS`;
             });
        });

        // --- OTHELLO / C4 ---
        function renderOthello(b) {
            const c = document.getElementById('board-container'); c.innerHTML = '';
            const d = document.createElement('div'); d.className = 'othello-board';
            for(let y=0;y<8;y++)for(let x=0;x<8;x++){
                const el = document.createElement('div'); el.className = 'o-cell';
                el.onclick = () => socket.emit('othelloMove', {room:roomID, x, y, color:myColor});
                if(b[y][x]) { const s = document.createElement('div'); s.className = `o-stone o-${b[y][x]}`; el.appendChild(s); }
                d.appendChild(el);
            } c.appendChild(d);
        }
        function setupC4() {
            const c = document.getElementById('board-container'); c.innerHTML = '';
            const b = document.createElement('div'); b.className = 'c4-board';
            const g = document.createElement('div'); g.className = 'c4-grid';
            for(let i=0;i<42;i++) g.appendChild(document.createElement('div')).className='c4-hole';
            b.appendChild(g); c.appendChild(b);
            b.onclick = (e) => {
                const rect = b.getBoundingClientRect(); const col = Math.floor((e.clientX - rect.left - 15) / 70);
                if(col >= 0 && col < 7) socket.emit('connect4Move', {room:roomID, col});
            };
        }
        function updateTurn(t) {
            const isP1 = (t==='black'||t==='red');
            document.getElementById('p1-tag').style.color = isP1 ? '#fff' : '#555';
            document.getElementById('p2-tag').style.color = !isP1 ? '#fff' : '#555';
        }

        socket.on('othelloUpdate', d => renderOthello(d.board));
        socket.on('connect4Update', d => {
            const p = document.createElement('div'); p.className = `c4-piece c4-${d.color==='red'?'red':'cyan'} falling`;
            p.style.left = (15 + d.col * 70) + 'px'; p.style.top = (15 + d.row * 70) + 'px';
            document.querySelector('.c4-board').appendChild(p);
        });
        socket.on('changeTurn', t => updateTurn(t));
        socket.on('gameOver', d => { alert(d.msg); location.reload(); });
        socket.on('forceReset', () => location.reload());

    </script>
</body>
</html>